/**
* This file was automatically generated by OMG (OpenMicrofrontends Generator).
* DO NOT MODIFY!
*/

import {createProxyServer} from 'http-proxy-3';
import type {ServerResponse, IncomingMessage} from 'node:http';
import type {OpenMicrofrontendsClientContext} from '@open-microfrontends/types/OpenMicrofrontendsRendererFunction';
<% if (spec.microfrontends.find((m) => m.ssr)) { %>
    import type {OpenMicrofrontendsServerContext} from '@open-microfrontends/types/OpenMicrofrontendsServerSideRendererFunction';
<% } %>

interface Logger {
    debug(msg: string, ...args: any[]): void;
    info(msg: string, ...args: any[]): void;
    warn(msg: string, ...args: any[]): void;
    error(msg: string, ...args: any[]): void;
}

type ImportMap = {
    imports: Record<string, string>;
}

const DEFAULT_MICROFRONTEND_REQUEST_TIMEOUT_SEC = 5;
const DEFAULT_API_PROXY_TIMEOUT_SEC = 60;
const DEFAULT_SSR_TIMEOUT_SEC = 5;

<%- include('_urlHelper') %>

<%- include('_schemaTypes') %>

<%- include('_hostBackendIntegrationTypeScriptBase') %>

const getWithTimeoutAndExtraHeaders = async (url: string, baseUrl: string | null, timeoutSec: number, headers: Record<string, string>): Promise<Response> => {
    const fullUrl = toFullUrl(baseUrl, url);
    return await fetch(fullUrl, {
        method: 'GET',
        headers: {
            ...headers,
        },
        signal: AbortSignal.timeout(timeoutSec * 1000)
    });
}

const postWithTimeoutAndExtraHeaders = async (url: string, baseUrl: string | null, body: object, timeoutSec: number, headers: Record<string, string>): Promise<Response> => {
    const fullUrl = toFullUrl(baseUrl, url);
    return await fetch(fullUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            ...headers,
        },
        body: JSON.stringify(body),
        signal: AbortSignal.timeout(timeoutSec * 1000)
    });
}

<% for (let i = 0; i < spec.microfrontends.length; i ++) { %>
    <%- include('_hostBackendIntegrationNodeJsMiddleware', {i, spec, safeMicrofrontendNames}) %>
    <%- include('_hostBackendIntegrationNodeJsSSRFunction', {i, spec, safeMicrofrontendNames}) %>
<% } -%>
