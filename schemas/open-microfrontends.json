{
  "$id": "https://open-microfrontends/schemas/1-0-0",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$defs": {
    "I18NString": {
      "oneOf": [
        {
          "type": "string"
        },
        {
          "type": "object",
          "patternProperties": {
            "^[a-z]{2}$": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "HttpUrl": {
      "type": "string",
      "pattern": "^(\\$|http://|https://).*$"
    },
    "HttpOrWebSocketUrlOrRelativePath": {
      "type": "string",
      "pattern": "^(\\$|http://|https://|ws://|wss://|/[a-zA-Z]).*$"
    },
    "RelativeJsPath": {
      "type": "string",
      "pattern": "^[a-z].*\\.(mjs|js)$"
    },
    "RelativeCssPath": {
      "type": "string",
      "pattern": "^[a-z].*\\.css$"
    },
    "RelativeWebPath": {
      "type": "string",
      "pattern": "^/[a-zA-Z0-9-_/]*$"
    },
    "Roles": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "\\w+"
      }
    },
    "Server": {
      "type": "object",
      "properties": {
        "url": {
          "$ref": "#/$defs/HttpUrl"
        },
        "description": {
          "type": "string"
        }
      },
      "required": ["url"],
      "additionalProperties": false
    },
    "Resources": {
      "type": "object",
      "properties": {
        "js": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/RelativeJsPath"
          },
          "description": "A list of JS resources required to start the Microservice"
        },
        "css": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/RelativeCssPath"
          },
          "description": "A list of CSS resources that should be loaded"
        }
      },
      "required": ["js"],
      "additionalProperties": false
    },
    "Paths": {
      "type": "object",
      "properties": {
        "resourcesBase": {
          "$ref": "#/$defs/RelativeWebPath",
          "description": "The base path for the required resources"
        },
        "ssrHtml": {
          "$ref": "#/$defs/RelativeWebPath",
          "description": "The path to generate the initial HTML for Hybrid Rendering"
        }
      },
      "required": ["resourcesBase"],
      "additionalProperties": false
    },
    "Security": {
      "$comment": "This schema has been copied over from the OpenAPI schema https://spec.openapis.org/oas/3.1/schema/2025-03-19 and has been modified for our schema",
      "type": "array",
      "items": {
        "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-requirement"
      }
    },
    "APIProxyConfig": {
      "type": "object",
      "properties": {
        "url": {
          "$ref": "#/$defs/HttpOrWebSocketUrlOrRelativePath"
        },
        "security": {
          "$ref": "#/$defs/Security"
        }
      },
      "required": ["url"],
      "unevaluatedProperties": false
    },
    "APIProxy": {
      "type": "object",
      "patternProperties": {
        "^[a-zA-Z_][a-zA-Z0-9_]+$": {
          "anyOf": [{ "$ref": "#/$defs/HttpOrWebSocketUrlOrRelativePath" }, { "$ref": "#/$defs/APIProxyConfig" }]
        }
      },
      "additionalProperties": false,
      "description": "Defines private API endpoints the framework needs to provide relative paths for"
    },
    "Config": {
      "type": "object",
      "properties": {
        "schema": {
          "$ref": "https://json-schema.org/draft/2020-12/schema"
        },
        "default": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": ["schema", "default"],
      "additionalProperties": false
    },
    "Message": {
      "type": "object",
      "properties": {
        "publish": {
          "type": "boolean",
          "description": "The Microfrontend publish this message type"
        },
        "subscribe": {
          "type": "boolean",
          "description": "The Microfrontend subscribes this message type"
        },
        "schema": {
          "$ref": "https://json-schema.org/draft/2020-12/schema"
        }
      },
      "additionalProperties": false
    },
    "Messages": {
      "type": "object",
      "patternProperties": {
        "^.+$": {
          "$ref": "#/$defs/Message"
        }
      },
      "additionalProperties": false
    },
    "Annotations": {
      "type": "object",
      "additionalProperties": true,
      "description": "Some annotations for the framework(s) consuming this spec"
    },
    "Microfrontend": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "title": {
          "$ref": "#/$defs/I18NString"
        },
        "description": {
          "type": "string"
        },
        "security": {
          "$ref": "#/$defs/Security"
        },
        "resources": {
          "$ref": "#/$defs/Resources"
        },
        "paths": {
          "$ref": "#/$defs/Paths"
        },
        "frontendPermissions": {
          "description": "Defines all user-permissions used within this microfrontend",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "globalLaunchFunction": {
          "type": "string",
          "description": "The name of the function that can be used in the browser to launch this microfrontend"
        },
        "apiProxies": {
          "$ref": "#/$defs/APIProxy"
        },
        "config": {
          "$ref": "#/$defs/Config"
        },
        "messages": {
          "$ref": "#/$defs/Messages"
        },
        "annotations": {
          "$ref": "#/$defs/Annotations"
        }
      },
      "required": ["name", "resources", "paths", "globalLaunchFunction"],
      "additionalProperties": false
    },
    "_EXTERNAL": {
      "$comment": "This section contains all third-party schemas",
      "_OPEN_API": {
        "$comment": "All schemas in this section have been copied over from the OpenAPI schema https://spec.openapis.org/oas/3.1/schema/2025-03-19 and have their $ref adjusted for our schema",
        "reference": {
          "$comment": "https://spec.openapis.org/oas/v3.1#reference-object",
          "type": "object",
          "properties": {
            "$ref": {
              "type": "string",
              "format": "uri-reference"
            },
            "summary": {
              "type": "string"
            },
            "description": {
              "type": "string"
            }
          }
        },
        "security-scheme": {
          "$comment": "https://spec.openapis.org/oas/v3.1#security-scheme-object",
          "type": "object",
          "properties": {
            "type": {
              "enum": ["apiKey", "http", "mutualTLS", "oauth2", "openIdConnect"]
            },
            "description": {
              "type": "string"
            }
          },
          "required": ["type"],
          "allOf": [
            {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/specification-extensions"
            },
            {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-scheme/$defs/type-apikey"
            },
            {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-scheme/$defs/type-http"
            },
            {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-scheme/$defs/type-http-bearer"
            },
            {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-scheme/$defs/type-oauth2"
            },
            {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-scheme/$defs/type-oidc"
            }
          ],
          "unevaluatedProperties": false,
          "$defs": {
            "type-apikey": {
              "if": {
                "properties": {
                  "type": {
                    "const": "apiKey"
                  }
                },
                "required": ["type"]
              },
              "then": {
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "in": {
                    "enum": ["query", "header", "cookie"]
                  }
                },
                "required": ["name", "in"]
              }
            },
            "type-http": {
              "if": {
                "properties": {
                  "type": {
                    "const": "http"
                  }
                },
                "required": ["type"]
              },
              "then": {
                "properties": {
                  "scheme": {
                    "type": "string"
                  }
                },
                "required": ["scheme"]
              }
            },
            "type-http-bearer": {
              "if": {
                "properties": {
                  "type": {
                    "const": "http"
                  },
                  "scheme": {
                    "type": "string",
                    "pattern": "^[Bb][Ee][Aa][Rr][Ee][Rr]$"
                  }
                },
                "required": ["type", "scheme"]
              },
              "then": {
                "properties": {
                  "bearerFormat": {
                    "type": "string"
                  }
                }
              }
            },
            "type-oauth2": {
              "if": {
                "properties": {
                  "type": {
                    "const": "oauth2"
                  }
                },
                "required": ["type"]
              },
              "then": {
                "properties": {
                  "flows": {
                    "$ref": "#/$defs/_EXTERNAL/_OPEN_API/oauth-flows"
                  }
                },
                "required": ["flows"]
              }
            },
            "type-oidc": {
              "if": {
                "properties": {
                  "type": {
                    "const": "openIdConnect"
                  }
                },
                "required": ["type"]
              },
              "then": {
                "properties": {
                  "openIdConnectUrl": {
                    "type": "string",
                    "format": "uri-reference"
                  }
                },
                "required": ["openIdConnectUrl"]
              }
            }
          }
        },
        "security-scheme-or-reference": {
          "if": {
            "type": "object",
            "required": ["$ref"]
          },
          "then": {
            "$ref": "#/$defs/_EXTERNAL/_OPEN_API/reference"
          },
          "else": {
            "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-scheme"
          }
        },
        "security-requirement": {
          "$comment": "https://spec.openapis.org/oas/v3.1#security-requirement-object",
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "oauth-flows": {
          "type": "object",
          "properties": {
            "implicit": {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/oauth-flows/$defs/implicit"
            },
            "password": {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/oauth-flows/$defs/password"
            },
            "clientCredentials": {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/oauth-flows/$defs/client-credentials"
            },
            "authorizationCode": {
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/oauth-flows/$defs/authorization-code"
            }
          },
          "$ref": "#/$defs/_EXTERNAL/_OPEN_API/specification-extensions",
          "unevaluatedProperties": false,
          "$defs": {
            "implicit": {
              "type": "object",
              "properties": {
                "authorizationUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "refreshUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "scopes": {
                  "$ref": "#/$defs/_EXTERNAL/_OPEN_API/map-of-strings"
                }
              },
              "required": ["authorizationUrl", "scopes"],
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/specification-extensions",
              "unevaluatedProperties": false
            },
            "password": {
              "type": "object",
              "properties": {
                "tokenUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "refreshUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "scopes": {
                  "$ref": "#/$defs/_EXTERNAL/_OPEN_API/map-of-strings"
                }
              },
              "required": ["tokenUrl", "scopes"],
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/specification-extensions",
              "unevaluatedProperties": false
            },
            "client-credentials": {
              "type": "object",
              "properties": {
                "tokenUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "refreshUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "scopes": {
                  "$ref": "#/$defs/_EXTERNAL/_OPEN_API/map-of-strings"
                }
              },
              "required": ["tokenUrl", "scopes"],
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/specification-extensions",
              "unevaluatedProperties": false
            },
            "authorization-code": {
              "type": "object",
              "properties": {
                "authorizationUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "tokenUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "refreshUrl": {
                  "type": "string",
                  "format": "uri-reference"
                },
                "scopes": {
                  "$ref": "#/$defs/_EXTERNAL/_OPEN_API/map-of-strings"
                }
              },
              "required": ["authorizationUrl", "tokenUrl", "scopes"],
              "$ref": "#/$defs/_EXTERNAL/_OPEN_API/specification-extensions",
              "unevaluatedProperties": false
            }
          }
        },
        "specification-extensions": {
          "$comment": "https://spec.openapis.org/oas/v3.1#specification-extensions",
          "patternProperties": {
            "^x-": true
          }
        },
        "map-of-strings": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    }
  },
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string"
    },
    "securitySchemes": {
      "$comment": "This schema has been copied over from the OpenAPI schema https://spec.openapis.org/oas/3.1/schema/2025-03-19 and has been modified for our schema",
      "description": "Section for defining re-usable security schemes for API proxies",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/_EXTERNAL/_OPEN_API/security-scheme-or-reference"
      }
    },
    "openMicrofrontends": {
      "type": "string",
      "pattern": "^1\\.0\\.\\d+(-.+)?$"
    },
    "servers": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Server"
      }
    },
    "microfrontends": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Microfrontend"
      }
    }
  },
  "required": ["openMicrofrontends", "microfrontends"],
  "additionalProperties": false
}
